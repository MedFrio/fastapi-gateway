# ğŸ½ï¸ API Gateway - Projet Microservices Restaurant

Ce projet constitue l'**API Gateway** d'une application de gestion de commandes pour un restaurant. Il s'inscrit dans une architecture **microservices** rÃ©partie entre plusieurs domaines mÃ©tier : client, commande, cuisine et livraison.

---

## ğŸ“Œ Objectifs

- Servir de **point d'entrÃ©e unique** pour le Frontend.
- Centraliser les appels vers les microservices.
- IntÃ©grer les **services rÃ©els** (clients, commandes).
- Simuler les Ã©changes pour les services non disponibles.
- GÃ©rer les erreurs et assurer un **mode dÃ©gradÃ©**.

---

## ğŸ› ï¸ Technologies utilisÃ©es

| Composant     | Techno      |
|---------------|-------------|
| API Gateway   | FastAPI     |
| HTTP Client   | HTTPX       |
| Langage       | Python 3.10+|

---

## ğŸ“ Architecture


api_gateway/
â”œâ”€â”€ main.py                          # Point dâ€™entrÃ©e de lâ€™API Gateway
â”œâ”€â”€ requirements.txt                 # DÃ©pendances Python
â”œâ”€â”€ services/                        # Regroupe les routes par domaine fonctionnel
â”‚   â”œâ”€â”€ auth.py                      # Authentification fictive (dÃ©mo/testing)
â”‚   â”œâ”€â”€ client_api.py                # Redirection vers le microservice Gestion-client-ms
â”‚   â”œâ”€â”€ order_api.py                 # Redirection vers le microservice de gestion des commandes
â”‚   â”œâ”€â”€ orders.py                    # Commandes simulÃ©es (ancien mock, facultatif)
â”‚   â”œâ”€â”€ kitchen.py                   # Module cuisine simulÃ© (statut des plats)
â”‚   â””â”€â”€ delivery.py                  # Module livraison simulÃ©
â”œâ”€â”€ utils/
    â””â”€â”€ http_client.py               # Outil gÃ©nÃ©rique pour les appels HTTP simulÃ©s (test/local)


---

## ğŸš€ Lancer le projet

### 1. Cloner le dÃ©pÃ´t
```bash
git clone <url_du_repo>
cd api_gateway
```
### 2. CrÃ©er et activer un environnement virtuel
```bash
python -m venv venv
source venv/bin/activate  # sur Windows : venv\Scripts\activate
```
### 3. Installer les dÃ©pendances
```bash
pip install -r requirements.txt
```
### 4. Lancer l'API Gateway
```bash
uvicorn main:app --reload --port 8000
```

## ğŸ”— Endpoints disponibles

### ğŸ” Authentification (rÃ©elle, dÃ©lÃ©guÃ©e Ã  `Gestion-client-ms`)
> L'authentification est **entiÃ¨rement fonctionnelle** : la Gateway redirige toutes les requÃªtes vers le microservice `Gestion-client-ms`, qui gÃ¨re les **JWT**, les **rÃ´les** et les **sessions**.
>  
> ğŸ“Œ La Gateway ne valide pas les tokens elle-mÃªme, mais relaie les headers `Authorization: Bearer <token>` au microservice qui, lui, fait les contrÃ´les.

| MÃ©thode | Endpoint                          | Description                                 | Auth requise |
|--------:|-----------------------------------|---------------------------------------------|--------------|
| `POST`  | `/client-api/login`               | Connexion d'un client (retourne JWT)        | âŒ           |
| `POST`  | `/client-api/clients`             | CrÃ©er un nouveau client                     | âŒ           |
| `GET`   | `/client-api/clients`             | Lister les clients                          | âŒ           |
| `GET`   | `/client-api/clients/{id}`        | RÃ©cupÃ©rer un client par ID                  | âŒ           |
| `DELETE`| `/client-api/clients/{id}`        | Supprimer un client                         | âŒ           |
| `POST`  | `/client-api/logout`              | DÃ©connexion (invalide le JWT)               | âœ…           |
| `POST`  | `/client-api/logout-all`          | DÃ©connexion toutes sessions                 | âœ…           |
| `GET`   | `/client-api/sessions`            | Lister les sessions actives                 | âœ…           |

---

### ğŸ“– Menu et commandes (Service Commandes - rÃ©el)

| MÃ©thode | Endpoint                                         | Description                            |
|--------:|--------------------------------------------------|----------------------------------------|
| `GET`   | `/order-api/menu`                                | Lister tous les plats                  |
| `GET`   | `/order-api/menu/filter?categorie=...`           | Filtrer les plats par catÃ©gorie        |
| `POST`  | `/order-api/commandes`                           | CrÃ©er une commande                     |
| `GET`   | `/order-api/commandes`                           | Lister toutes les commandes            |
| `GET`   | `/order-api/commandes/{id}`                      | DÃ©tail d'une commande                  |
| `PATCH` | `/order-api/commandes/{id}/status`               | Mettre Ã  jour le statut d'une commande|

---

### ğŸ³ Cuisine (simulÃ©e localement)
| MÃ©thode | Endpoint               | Description                            |
|--------:|------------------------|----------------------------------------|
| `GET`   | `/kitchen/orders`      | Commandes en cours cÃ´tÃ© cuisine        |
| `POST`  | `/kitchen/update`      | Marquer une commande comme "prÃªte"     |

---

### ğŸšš Livraison (simulÃ©e localement)
| MÃ©thode | Endpoint               | Description                            |
|--------:|------------------------|----------------------------------------|
| `GET`   | `/delivery/assigned`   | Liste des commandes Ã  livrer           |
| `POST`  | `/delivery/update`     | Marquer une commande comme livrÃ©e      |


## ğŸ§ª Simulation de panne & mode dÃ©gradÃ©

Le module `http_client.py` est toujours prÃ©sent dans le projet.  
Il permet de **simuler les appels aux microservices** en mode fallback local, mais n'est **plus utilisÃ© activement**.
En cas de panne ou dâ€™indisponibilitÃ© (par exemple, suppression temporaire dâ€™une route), lâ€™API Gateway :

- Renvoie un message dâ€™erreur clair au frontend
- Garde les autres fonctionnalitÃ©s opÃ©rationnelles

---

## âœ… Objectifs pÃ©dagogiques couverts

- âœ… PrÃ©sentation claire du contexte et des services
- âœ… DÃ©monstration fonctionnelle complÃ¨te (auth, commande, cuisine, livraison)
- âœ… Architecture Microservices respectÃ©e (Gateway + dÃ©coupage logique)
- âœ… Simulation panne gÃ©rÃ©e efficacement (retour JSON dâ€™erreur)
